from __future__ import annotations

import importlib
import sys
from functools import lru_cache
from types import ModuleType
from typing import Dict
from pathlib import Path

import streamlit as st

# β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
# β… [ν•µμ‹¬] κ²½λ΅ λ¬Έμ  λ°©μ§€: λ£¨νΈ κ²½λ΅λ¥Ό sys.pathμ— μ¶”κ°€!
# β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
# λ£¨νΈ: app.py κΈ°μ¤€ μƒμ„ κ²½λ΅
PROJECT_ROOT = Path(__file__).resolve().parent
sys.path.append(str(PROJECT_ROOT))

# β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
# Streamlit κΈ°λ³Έ μ„¤μ •
# β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
st.set_page_config(
    page_title="λ³΄μ• μ κ²€ μ‹μ¤ν…",
    page_icon="π›΅οΈ",
    layout="wide",
    initial_sidebar_state="expanded",
)

# β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
# β… [μ¤‘μ”] μ‹¤μ  ν΄λ” κµ¬μ΅°μ— λ§κ² import κ²½λ΅ μ κ²€
# μ) WebPage/pages/page_1_main_page.py μ΄λ©΄ β†’ 'WebPage.pages.page_1_main_page'
# β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
PAGES: Dict[str, str] = {
    "π  λ©”μΈνμ΄μ§€":       "WebPage.pages.page_1_main_page",
    "β… μ κ²€":             "WebPage.pages.page_5_scanpage",
    "π“‹ μ§„λ‹¨ κ²°κ³Ό λ¶„μ„":   "WebPage.pages.page_3_diagnosis_result",
}

CAPTIONS: Dict[str, str] = {
    "π  λ©”μΈνμ΄μ§€":       "μ‹μ¤ν… κ°μ” λ° μ•λ‚΄ νμ΄μ§€μ…λ‹λ‹¤.",
    "β… μ κ²€":             "μ„ νƒ μ„λ²„μ— λ€ν•΄ μ‹¤μ‹κ°„ λ³΄μ• μ κ²€μ„ μν–‰ν•©λ‹λ‹¤.",
    "π“‹ μ§„λ‹¨ κ²°κ³Ό λ¶„μ„":   "μ „μ²΄ μ§„λ‹¨ κ²°κ³Όλ¥Ό ν…μ΄λΈ”λ΅ ν™•μΈν•κ³  μ΅°μΉ λ°©λ²•μ„ κ²€ν† ν•©λ‹λ‹¤.",
}

# β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
# μµμ΄ μ§„μ… μ‹ κΈ°λ³Έ νμ΄μ§€ μ„¤μ •
# β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
if "current_page" not in st.session_state:
    st.session_state.current_page = next(iter(PAGES))  # μ²« ν•­λ©

@lru_cache(maxsize=None)
def _import_page(module_path: str) -> ModuleType:
    """λ™μ  import + μΊμ‹±"""
    return importlib.import_module(module_path)

# β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
# μ‚¬μ΄λ“λ°” UI
# β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
st.sidebar.title("π›΅οΈ λ³΄μ• μ κ²€ μ‹μ¤ν…")
st.sidebar.markdown("---")

page_selection = st.sidebar.radio(
    "π§­ **νμ΄μ§€ μ΄λ™**",
    list(PAGES.keys()),
    index=list(PAGES.keys()).index(st.session_state.current_page),
    key="current_page",
)

st.sidebar.caption(CAPTIONS[page_selection])
st.sidebar.markdown("---")
st.sidebar.metric("μ—°κ²° μƒνƒ", "πΆ μ •μƒ")
st.sidebar.caption("Β© 2025 λ³΄μ• μ κ²€ μ‹μ¤ν… v1.0.0")

# β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
# νμ΄μ§€ λ λ”λ§
# β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
try:
    _import_page(PAGES[page_selection]).show()
except ModuleNotFoundError as err:
    st.error(f"β λ¨λ“μ„ μ°Ύμ„ μ μ—†μµλ‹λ‹¤: `{PAGES[page_selection]}`\n\n{err}")
    st.info("π“ import κ²½λ΅μ™€ ν΄λ” κµ¬μ΅°λ¥Ό λ‹¤μ‹ ν™•μΈν•΄μ£Όμ„Έμ”!")
except Exception as err:
    st.exception(err)
    st.info("π”„ μƒλ΅κ³ μΉ¨ ν›„ λ‹¤μ‹ μ‹λ„ν•΄ μ£Όμ„Έμ”.")
